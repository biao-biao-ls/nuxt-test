<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>左侧栏可见性测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            margin: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        .test-title {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .test-description {
            color: #666;
            margin-bottom: 15px;
            line-height: 1.5;
        }
        .test-result {
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        .success {
            background-color: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        .info {
            background-color: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        button:hover {
            background-color: #0056b3;
        }
        .agent-list {
            margin: 10px 0;
            padding: 10px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .agent-item {
            margin: 5px 0;
            padding: 5px;
            background-color: white;
            border-radius: 3px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .status-online {
            color: #28a745;
            font-weight: bold;
        }
        .status-offline {
            color: #dc3545;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <div class="test-title">左侧栏可见性逻辑测试</div>
        <div class="test-description">
            这个测试页面用于验证"无客服在线时不显示自定义左侧UI"的功能。
            <br>
            测试逻辑：当所有客服都离线时，左侧栏应该隐藏；当至少有一个客服在线时，左侧栏应该显示。
        </div>

        <div class="agent-list" id="agentList">
            <div class="test-title" style="font-size: 14px; margin-bottom: 10px;">客服状态列表：</div>
        </div>

        <button onclick="testAllOffline()">测试：所有客服离线</button>
        <button onclick="testSomeOnline()">测试：部分客服在线</button>
        <button onclick="testAllOnline()">测试：所有客服在线</button>
        <button onclick="resetToDefault()">重置为默认状态</button>

        <div id="testResult" class="test-result info">
            点击上方按钮开始测试...
        </div>
    </div>

    <script>
        // 模拟客服数据
        const mockAgents = [
            {
                employeeEnName: "test_01",
                quickCepId: "1938524999731687426",
                isOnline: false,
                status: 1,
                businessLine: "3D Printing"
            },
            {
                employeeEnName: "caocao",
                quickCepId: "1942407035945005058",
                isOnline: false,
                status: 1,
                businessLine: "3D Printing"
            },
            {
                employeeEnName: "xiaozhou",
                quickCepId: "1938144757068906498",
                isOnline: false,
                status: 1,
                businessLine: "PCB Assembly"
            },
            {
                employeeEnName: "Alex",
                quickCepId: "1946056607741292545",
                isOnline: false,
                status: 1,
                businessLine: "SMT Services"
            }
        ];

        // 模拟ChatCustomUI类的hasOnlineAgents方法
        function hasOnlineAgents(agents) {
            return agents.some(agent => agent.isOnline);
        }

        // 模拟updateLeftBarVisibility方法
        function updateLeftBarVisibility(agents) {
            const hasOnline = hasOnlineAgents(agents);
            const resultDiv = document.getElementById('testResult');
            
            if (hasOnline) {
                resultDiv.className = 'test-result success';
                resultDiv.innerHTML = `
                    ✅ 检测到有客服在线，左侧栏应该显示<br>
                    在线客服数量: ${agents.filter(a => a.isOnline).length}/${agents.length}
                `;
            } else {
                resultDiv.className = 'test-result info';
                resultDiv.innerHTML = `
                    ℹ️ 无客服在线，左侧栏应该隐藏<br>
                    在线客服数量: 0/${agents.length}
                `;
            }
            
            updateAgentList(agents);
            return hasOnline;
        }

        // 更新客服列表显示
        function updateAgentList(agents) {
            const listDiv = document.getElementById('agentList');
            let html = '<div class="test-title" style="font-size: 14px; margin-bottom: 10px;">客服状态列表：</div>';
            
            agents.forEach(agent => {
                const statusClass = agent.isOnline ? 'status-online' : 'status-offline';
                const statusText = agent.isOnline ? '在线' : '离线';
                html += `
                    <div class="agent-item">
                        <span>${agent.employeeEnName} (${agent.businessLine})</span>
                        <span class="${statusClass}">${statusText}</span>
                    </div>
                `;
            });
            
            listDiv.innerHTML = html;
        }

        // 测试函数
        function testAllOffline() {
            console.log('测试：所有客服离线');
            const testAgents = mockAgents.map(agent => ({...agent, isOnline: false, status: 1}));
            updateLeftBarVisibility(testAgents);
        }

        function testSomeOnline() {
            console.log('测试：部分客服在线');
            const testAgents = mockAgents.map((agent, index) => ({
                ...agent, 
                isOnline: index < 2, // 前两个客服在线
                status: index < 2 ? 2 : 1
            }));
            updateLeftBarVisibility(testAgents);
        }

        function testAllOnline() {
            console.log('测试：所有客服在线');
            const testAgents = mockAgents.map(agent => ({...agent, isOnline: true, status: 2}));
            updateLeftBarVisibility(testAgents);
        }

        function resetToDefault() {
            console.log('重置为默认状态');
            updateLeftBarVisibility(mockAgents);
        }

        // 初始化显示
        updateLeftBarVisibility(mockAgents);
    </script>
</body>
</html>