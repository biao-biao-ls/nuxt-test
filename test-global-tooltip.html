<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>全局 Tooltip 方法测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
            line-height: 1.6;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        
        .title {
            font-size: 24px;
            font-weight: 600;
            margin-bottom: 20px;
            color: #333;
            text-align: center;
        }
        
        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            cursor: pointer;
            margin: 10px;
            font-size: 14px;
            transition: background-color 0.2s ease;
        }
        
        .test-button:hover {
            background: #0056b3;
        }
        
        .agent-item {
            display: inline-flex;
            align-items: center;
            gap: 10px;
            padding: 15px 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: white;
            cursor: pointer;
            margin: 10px;
            transition: all 0.2s ease;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .agent-item:hover {
            background: #f0f8ff;
            border-color: #007bff;
        }
        
        .agent-avatar {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            background: #007bff;
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }
        
        .debug-info {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
            font-family: monospace;
            font-size: 12px;
            max-height: 300px;
            overflow-y: auto;
        }
        
        .status {
            padding: 8px 12px;
            border-radius: 4px;
            margin: 5px 0;
            font-weight: 500;
        }
        
        .status.success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .status.error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .status.info {
            background: #d1ecf1;
            color: #0c5460;
            border: 1px solid #bee5eb;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="title">全局 Tooltip 方法测试</div>
        
        <div id="status-container">
            <div class="status info">正在检查全局方法...</div>
        </div>
        
        <div>
            <button class="test-button" onclick="checkGlobalMethods()">检查全局方法</button>
            <button class="test-button" onclick="testDirectTooltip()">直接测试 Tooltip</button>
            <button class="test-button" onclick="createMockChatUI()">创建模拟 ChatUI</button>
        </div>
        
        <div>
            <p><strong>测试客服元素（使用全局方法调用）：</strong></p>
            
            <div class="agent-item" 
                 onmouseover="testGlobalTooltip(event, 'James', 'Sales Manager')"
                 onmouseout="testGlobalHideTooltip()">
                <div class="agent-avatar">J</div>
                <div>
                    <div>James</div>
                    <div style="font-size: 12px; color: #666;">Sales Manager</div>
                </div>
            </div>
            
            <div class="agent-item" 
                 onmouseover="testGlobalTooltip(event, 'Nathan', 'Technical Support')"
                 onmouseout="testGlobalHideTooltip()">
                <div class="agent-avatar">N</div>
                <div>
                    <div>Nathan</div>
                    <div style="font-size: 12px; color: #666;">Technical Support</div>
                </div>
            </div>
        </div>
        
        <div class="debug-info" id="debug-log"></div>
    </div>
    
    <!-- Tooltip 元素 -->
    <div id="agent-tooltip" style="
        position: absolute;
        background: rgba(0, 0, 0, 0.9);
        color: white;
        padding: 8px 12px;
        border-radius: 6px;
        font-size: 13px;
        font-weight: 500;
        line-height: 1.4;
        z-index: 99999;
        display: none;
        pointer-events: none;
        white-space: nowrap;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.25);
        max-width: 250px;
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
    "></div>
    
    <script>
        let debugLog = [];
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            debugLog.push(`[${timestamp}] ${message}`);
            document.getElementById('debug-log').innerHTML = debugLog.slice(-15).join('<br>');
            console.log(message);
            
            // 更新状态显示
            const statusContainer = document.getElementById('status-container');
            const statusClass = type === 'error' ? 'error' : type === 'success' ? 'success' : 'info';
            statusContainer.innerHTML = `<div class="status ${statusClass}">${message}</div>`;
        }
        
        function checkGlobalMethods() {
            log('开始检查全局方法...');
            
            // 检查 window.chatUI
            if (typeof window.chatUI !== 'undefined') {
                log('✓ window.chatUI 存在', 'success');
                
                if (typeof window.chatUI.showTooltip === 'function') {
                    log('✓ window.chatUI.showTooltip 方法存在', 'success');
                } else {
                    log('✗ window.chatUI.showTooltip 方法不存在', 'error');
                }
                
                if (typeof window.chatUI.hideTooltip === 'function') {
                    log('✓ window.chatUI.hideTooltip 方法存在', 'success');
                } else {
                    log('✗ window.chatUI.hideTooltip 方法不存在', 'error');
                }
            } else {
                log('✗ window.chatUI 不存在', 'error');
            }
            
            // 检查 window.parent.chatUI
            try {
                if (typeof window.parent.chatUI !== 'undefined') {
                    log('✓ window.parent.chatUI 存在', 'success');
                } else {
                    log('✗ window.parent.chatUI 不存在', 'error');
                }
            } catch (e) {
                log('✗ 无法访问 window.parent.chatUI: ' + e.message, 'error');
            }
        }
        
        function testDirectTooltip() {
            log('测试直接 tooltip 显示...');
            
            const tooltip = document.getElementById('agent-tooltip');
            if (tooltip) {
                tooltip.innerHTML = '<div style="font-weight: 600; margin-bottom: 2px;">测试</div><div style="opacity: 0.9; font-size: 12px;">直接显示测试</div>';
                tooltip.style.display = 'block';
                tooltip.style.left = '200px';
                tooltip.style.top = '200px';
                
                log('✓ 直接显示 tooltip 成功', 'success');
                
                setTimeout(() => {
                    tooltip.style.display = 'none';
                    log('隐藏 tooltip');
                }, 2000);
            } else {
                log('✗ 找不到 tooltip 元素', 'error');
            }
        }
        
        function createMockChatUI() {
            log('创建模拟 ChatUI...');
            
            // 创建简单的模拟对象
            window.chatUI = {
                showTooltip: function(event, name, role) {
                    log(`模拟 showTooltip 被调用: ${name}, ${role}`);
                    
                    const tooltip = document.getElementById('agent-tooltip');
                    if (tooltip) {
                        tooltip.innerHTML = `<div style="font-weight: 600; margin-bottom: 2px;">${name}</div><div style="opacity: 0.9; font-size: 12px;">${role}</div>`;
                        tooltip.style.display = 'block';
                        tooltip.style.left = (event.clientX + 12) + 'px';
                        tooltip.style.top = (event.clientY - 50) + 'px';
                        log(`✓ Tooltip 显示在: (${event.clientX + 12}, ${event.clientY - 50})`, 'success');
                    }
                },
                hideTooltip: function() {
                    log('模拟 hideTooltip 被调用');
                    
                    const tooltip = document.getElementById('agent-tooltip');
                    if (tooltip) {
                        tooltip.style.display = 'none';
                        log('✓ Tooltip 已隐藏', 'success');
                    }
                }
            };
            
            log('✓ 模拟 ChatUI 创建成功', 'success');
        }
        
        function testGlobalTooltip(event, name, role) {
            log(`尝试调用全局 tooltip: ${name}`);
            
            if (window.chatUI && window.chatUI.showTooltip) {
                window.chatUI.showTooltip(event, name, role);
            } else if (window.parent.chatUI && window.parent.chatUI.showTooltip) {
                window.parent.chatUI.showTooltip(event, name, role);
            } else {
                log('✗ 找不到可用的 showTooltip 方法', 'error');
            }
        }
        
        function testGlobalHideTooltip() {
            if (window.chatUI && window.chatUI.hideTooltip) {
                window.chatUI.hideTooltip();
            } else if (window.parent.chatUI && window.parent.chatUI.hideTooltip) {
                window.parent.chatUI.hideTooltip();
            } else {
                log('✗ 找不到可用的 hideTooltip 方法', 'error');
            }
        }
        
        // 页面加载时自动检查
        document.addEventListener('DOMContentLoaded', function() {
            log('页面加载完成，开始检查...');
            setTimeout(checkGlobalMethods, 500);
        });
    </script>
</body>
</html>