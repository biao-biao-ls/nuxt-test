<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>操作员弹框测试</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }

        .test-container {
            max-width: 600px;
            margin: 0 auto;
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }

        .test-button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 5px;
            cursor: pointer;
            margin: 10px;
        }

        .test-button:hover {
            background: #0056b3;
        }

        .mock-header {
            border: 1px solid #ddd;
            padding: 10px;
            margin: 20px 0;
            border-radius: 5px;
            background: #f8f9fa;
        }
    </style>
</head>

<body>
    <div class="test-container">
        <h1>操作员弹框功能测试</h1>

        <div class="mock-header" id="header-container">
            <!-- 这里会渲染头部内容 -->
        </div>

        <button class="test-button" onclick="testShowModal()">显示操作员弹框</button>
        <button class="test-button" onclick="testHideModal()">隐藏操作员弹框</button>
        <button class="test-button" onclick="testUpdateData()">更新操作员数据</button>

        <h3>功能说明：</h3>
        <ul>
            <li>点击头部的操作员头像或省略号应该显示弹框</li>
            <li>弹框显示所有操作员列表</li>
            <li>当前操作员有蓝色虚线边框</li>
            <li>点击背景或关闭按钮可以关闭弹框</li>
        </ul>
    </div>

    <script type="module">
        // 模拟导入 ChatCustomUI 类
        // 在实际环境中，这会从模块中导入

        // 模拟操作员数据
        const mockOperatorData = [
            {
                quickCepId: "op1",
                employeeEnName: "Tiandoudou",
                roleNameEn: "Customer Service",
                imageFileIndexId: "mock-image-1",
                status: 2,
                isOnline: true,
                businessLine: "PCB"
            },
            {
                quickCepId: "op2",
                employeeEnName: "Alice Smith",
                roleNameEn: "Technical Support",
                imageFileIndexId: "mock-image-2",
                status: 2,
                isOnline: true,
                businessLine: "SMT"
            },
            {
                quickCepId: "op3",
                employeeEnName: "Bob Johnson",
                roleNameEn: "Sales Support",
                imageFileIndexId: "mock-image-3",
                status: 3,
                isOnline: true,
                businessLine: "Assembly"
            },
            {
                quickCepId: "op4",
                employeeEnName: "Carol Davis",
                roleNameEn: "Customer Service",
                imageFileIndexId: "mock-image-4",
                status: 2,
                isOnline: true,
                businessLine: "PCB"
            },
            {
                quickCepId: "op5",
                employeeEnName: "David Wilson",
                roleNameEn: "Technical Support",
                imageFileIndexId: "mock-image-5",
                status: 2,
                isOnline: true,
                businessLine: "CNC"
            }
        ];

        // 创建 ChatCustomUI 实例（这里需要模拟实现）
        let chatUI = null;

        // 模拟初始化
        function initializeChatUI() {
            // 在实际环境中，这里会创建真正的 ChatCustomUI 实例
            console.log('初始化 ChatCustomUI...');

            // 模拟设置操作员数据
            if (chatUI) {
                chatUI.setOperatorListData(mockOperatorData);
                updateHeaderDisplay();
            }
        }

        // 更新头部显示
        function updateHeaderDisplay() {
            const headerContainer = document.getElementById('header-container');
            if (headerContainer && chatUI) {
                // 模拟渲染头部内容
                headerContainer.innerHTML = `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="font-weight: bold;">当前操作员：</div>
                        <div class="operator-agent" onclick="testShowModal()" style="cursor: pointer; padding: 4px; border: 1px solid #ddd; border-radius: 4px;">
                            <img src="https://via.placeholder.com/28" style="width: 28px; height: 28px; border-radius: 50%;">
                        </div>
                        <div class="operator-more-agents" onclick="testShowModal()" style="cursor: pointer; padding: 4px 8px; background: #f0f0f0; border-radius: 4px;">
                            •••
                        </div>
                        <span style="color: #666;">（点击头像或省略号测试弹框）</span>
                    </div>
                `;
            }
        }

        // 测试函数
        window.testShowModal = function () {
            console.log('显示操作员弹框');
            if (chatUI && chatUI.showOperatorModal) {
                chatUI.showOperatorModal();
            } else {
                // 模拟弹框显示
                showMockModal();
            }
        };

        window.testHideModal = function () {
            console.log('隐藏操作员弹框');
            if (chatUI && chatUI.hideOperatorModal) {
                chatUI.hideOperatorModal();
            } else {
                // 模拟弹框隐藏
                hideMockModal();
            }
        };

        window.testUpdateData = function () {
            console.log('更新操作员数据');
            // 添加一个新的操作员
            const newOperator = {
                quickCepId: "op" + (mockOperatorData.length + 1),
                employeeEnName: "New Operator",
                roleNameEn: "Support",
                imageFileIndexId: "mock-image-new",
                status: 2,
                isOnline: true,
                businessLine: "General"
            };
            mockOperatorData.push(newOperator);

            if (chatUI && chatUI.setOperatorListData) {
                chatUI.setOperatorListData(mockOperatorData);
            }
            console.log('操作员数据已更新，当前数量：', mockOperatorData.length);
        };

        // 模拟弹框显示（用于测试UI效果）
        function showMockModal() {
            // 移除已存在的弹框
            hideMockModal();

            const modalHTML = `
                <div id="operator-modal-container" style="position: fixed; top: 0; left: 0; right: 0; bottom: 0; z-index: 10000; pointer-events: auto;">
                    <style>
                        .operator-modal-backdrop {
                            position: absolute;
                            top: 0; left: 0; right: 0; bottom: 0;
                            background: rgba(0, 0, 0, 0.5);
                            backdrop-filter: blur(2px);
                            display: flex;
                            align-items: flex-end;
                            justify-content: center;
                            animation: fadeInBackdrop 0.3s ease-out;
                        }
                        .operator-modal-popup {
                            background: white;
                            border-radius: 16px 16px 0 0;
                            width: 100%;
                            max-width: 380px;
                            max-height: 80vh;
                            overflow: hidden;
                            box-shadow: 0 -10px 40px rgba(0, 0, 0, 0.15);
                            animation: slideUpOperator 0.3s cubic-bezier(0.25, 0.46, 0.45, 0.94);
                        }
                        .operator-modal-header {
                            display: flex;
                            justify-content: space-between;
                            align-items: center;
                            padding: 20px 24px;
                            border-bottom: 1px solid #f0f0f0;
                            background: white;
                        }
                        .operator-modal-title {
                            font-size: 18px;
                            font-weight: 600;
                            color: #333;
                        }
                        .operator-modal-close {
                            width: 32px; height: 32px;
                            border: 2px dashed #ccc;
                            border-radius: 8px;
                            background: transparent;
                            display: flex;
                            align-items: center;
                            justify-content: center;
                            cursor: pointer;
                            font-size: 18px;
                            color: #666;
                            font-weight: bold;
                        }
                        .operator-modal-list {
                            max-height: 60vh;
                            overflow-y: auto;
                            padding: 0;
                        }
                        .operator-modal-item {
                            display: flex;
                            align-items: center;
                            padding: 16px 24px;
                        }
                        .operator-avatar-wrapper {
                            position: relative;
                            margin-right: 16px;
                        }
                        .operator-avatar {
                            width: 48px; height: 48px;
                            border-radius: 50%;
                            border: none;
                            object-fit: cover;
                        }
                        .operator-status-indicator {
                            position: absolute;
                            bottom: 0px; right: 0px;
                            width: 14px; height: 14px;
                            border-radius: 50%;
                            border: 3px solid white;
                        }
                        .operator-info {
                            flex: 1;
                            display: flex;
                            align-items: center;
                            justify-content: space-between;
                        }
                        .operator-name {
                            font-size: 18px;
                            font-weight: 500;
                            color: #333;
                        }
                        .operator-status-text {
                            font-size: 16px;
                            font-weight: 400;
                            display: flex;
                            align-items: center;
                            gap: 6px;
                        }
                        .operator-status-text::before {
                            content: '';
                            width: 8px;
                            height: 8px;
                            border-radius: 50%;
                            background: #48DE8C;
                        }
                        @keyframes fadeInBackdrop {
                            from { opacity: 0; }
                            to { opacity: 1; }
                        }
                        @keyframes slideUpOperator {
                            from { transform: translateY(100%); opacity: 0; }
                            to { transform: translateY(0); opacity: 1; }
                        }
                    </style>
                    <div class="operator-modal-backdrop" onclick="testHideModal()">
                        <div class="operator-modal-popup" onclick="event.stopPropagation()">
                            <div class="operator-modal-header">
                                <span class="operator-modal-title">Group</span>
                                <span class="operator-modal-close" onclick="testHideModal()">×</span>
                            </div>
                            <div class="operator-modal-list">
                                ${mockOperatorData.map((agent, index) => `
                                    <div class="operator-modal-item">
                                        <div class="operator-avatar-wrapper">
                                            <img src="https://via.placeholder.com/48" class="operator-avatar">
                                            <div class="operator-status-indicator" style="background: #48DE8C;"></div>
                                        </div>
                                        <div class="operator-info">
                                            <div class="operator-name">${agent.employeeEnName}</div>
                                            <div class="operator-status-text" style="color: #48DE8C;">Online</div>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                    </div>
                </div>
            `;

            document.body.insertAdjacentHTML('beforeend', modalHTML);
        }

        function hideMockModal() {
            const modal = document.getElementById('operator-modal-container');
            if (modal) {
                modal.remove();
            }
        }

        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function () {
            initializeChatUI();
            updateHeaderDisplay();
        });
    </script>
</body>

</html>