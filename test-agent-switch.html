<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>客服切换功能测试</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 20px;
            background: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            max-width: 800px;
            margin: 0 auto;
        }
        .test-section {
            margin-bottom: 30px;
            padding: 15px;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
        }
        .test-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 15px;
            color: #333;
        }
        .demo-header {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            background: #fafafa;
            min-height: 50px;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button.success {
            background: #28a745;
        }
        button.warning {
            background: #ffc107;
            color: #212529;
        }
        .agent-list {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 10px;
            margin-top: 10px;
        }
        .agent-card {
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            background: white;
        }
        .agent-card.current {
            border-color: #28a745;
            background: #d4edda;
        }
        .log-area {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 10px;
            border-radius: 4px;
            height: 200px;
            overflow-y: auto;
            font-family: monospace;
            font-size: 12px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>客服切换功能测试</h1>
        
        <div class="test-section">
            <div class="test-title">当前客服显示区域</div>
            <div class="demo-header" id="current-agent-display">
                <!-- 当前客服信息将显示在这里 -->
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">可用客服列表</div>
            <div id="agent-list" class="agent-list">
                <!-- 客服列表将显示在这里 -->
            </div>
        </div>

        <div class="test-section">
            <div class="test-title">测试操作</div>
            <button onclick="refreshDisplay()">刷新显示</button>
            <button onclick="clearCurrentAgent()" class="warning">清除当前客服</button>
            <button onclick="showCurrentAgent()" class="success">显示当前客服</button>
            <button onclick="testRandomSwitch()">随机切换客服</button>
        </div>

        <div class="test-section">
            <div class="test-title">调试日志</div>
            <div id="log-area" class="log-area"></div>
            <button onclick="clearLog()">清除日志</button>
        </div>
    </div>

    <script>
        // 模拟ChatCustomUI类
        class MockChatUI {
            constructor() {
                this.state = {
                    currentChatAgent: null,
                    customerServiceData: [
                        {
                            employeeEnName: "test_01",
                            quickCepId: "1938524999731687426",
                            imageFileIndexId: "8454635530497527808",
                            roleNameEn: "Business Development Representative",
                            isOnline: true,
                            status: 2,
                            businessLine: "3D Printing",
                        },
                        {
                            employeeEnName: "caocao",
                            quickCepId: "1942407035945005058",
                            imageFileIndexId: "8454682774852571136",
                            roleNameEn: "Quality Assurance Agent",
                            isOnline: true,
                            status: 2,
                            businessLine: "3D Printing",
                        },
                        {
                            employeeEnName: "xiaozhou",
                            quickCepId: "1938144757068906498",
                            imageFileIndexId: "8593772030083227648",
                            roleNameEn: "Technical Support Specialist",
                            isOnline: false,
                            status: 1,
                            businessLine: "PCB Assembly",
                        }
                    ]
                };
            }

            selectAgent(quickCepId) {
                const agent = this.state.customerServiceData.find(a => a.quickCepId === quickCepId);
                if (agent) {
                    this.state.currentChatAgent = agent;
                    this.refreshUI();
                    log(`切换到客服: ${agent.employeeEnName}`);
                }
            }

            refreshUI() {
                updateCurrentAgentDisplay();
                updateAgentList();
            }

            renderCurrentAgent() {
                if (!this.state.currentChatAgent) {
                    return `
                        <div style="display: flex; align-items: center; gap: 8px;">
                            <svg width="36" height="36" viewBox="0 0 1024 1024" style="border-radius: 50%;">
                                <path d="M512 512m-512 0a512 512 0 1 0 1024 0 512 512 0 1 0-1024 0Z" fill="#2B8CED"></path>
                                <path d="M699.120941 570.819765l167.032471 0.180706c-4.216471 11.836235-22.768941 37.225412-29.876706 46.019764..." fill="#FFFFFF"></path>
                            </svg>
                            <span style="font-weight: 500; color: #444; font-size: 14px;">JLCONE</span>
                        </div>
                    `;
                }

                const agent = this.state.currentChatAgent;
                return `
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <img src="https://test.jlcerp.com/api/overseas-manage/employee/image/preview/${agent.imageFileIndexId}" 
                             style="width: 36px; height: 36px; border-radius: 50%; border: 2px solid #28a745;"
                             onerror="this.src='data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMzYiIGhlaWdodD0iMzYiIHZpZXdCb3g9IjAgMCAzNiAzNiIgZmlsbD0ibm9uZSI+PGNpcmNsZSBjeD0iMTgiIGN5PSIxOCIgcj0iMTgiIGZpbGw9IiNlOWVjZWYiLz48L3N2Zz4='">
                        <span style="font-weight: 500; color: #444; font-size: 14px;">${agent.employeeEnName}</span>
                        <span style="font-size: 12px; color: #6c757d;">(${agent.roleNameEn})</span>
                    </div>
                `;
            }
        }

        // 创建实例
        const mockChatUI = new MockChatUI();
        window.chatUI = mockChatUI;

        // 日志功能
        function log(message) {
            const logArea = document.getElementById('log-area');
            const timestamp = new Date().toLocaleTimeString();
            logArea.innerHTML += `[${timestamp}] ${message}\n`;
            logArea.scrollTop = logArea.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log-area').innerHTML = '';
        }

        // 更新显示
        function updateCurrentAgentDisplay() {
            const container = document.getElementById('current-agent-display');
            container.innerHTML = mockChatUI.renderCurrentAgent();
        }

        function updateAgentList() {
            const container = document.getElementById('agent-list');
            container.innerHTML = mockChatUI.state.customerServiceData.map(agent => {
                const isCurrent = mockChatUI.state.currentChatAgent && 
                                mockChatUI.state.currentChatAgent.quickCepId === agent.quickCepId;
                return `
                    <div class="agent-card ${isCurrent ? 'current' : ''}" onclick="selectAgent('${agent.quickCepId}')">
                        <div style="font-weight: 600;">${agent.employeeEnName}</div>
                        <div style="font-size: 12px; color: #666;">${agent.roleNameEn}</div>
                        <div style="font-size: 12px; color: ${agent.isOnline ? '#28a745' : '#dc3545'};">
                            ${agent.isOnline ? '在线' : '离线'}
                        </div>
                        ${isCurrent ? '<div style="color: #28a745; font-size: 12px;">● 当前客服</div>' : ''}
                    </div>
                `;
            }).join('');
        }

        // 测试函数
        function selectAgent(quickCepId) {
            log(`点击选择客服: ${quickCepId}`);
            mockChatUI.selectAgent(quickCepId);
        }

        function refreshDisplay() {
            log('手动刷新显示');
            mockChatUI.refreshUI();
        }

        function clearCurrentAgent() {
            log('清除当前客服');
            mockChatUI.state.currentChatAgent = null;
            mockChatUI.refreshUI();
        }

        function showCurrentAgent() {
            const current = mockChatUI.state.currentChatAgent;
            if (current) {
                log(`当前客服: ${current.employeeEnName} (${current.quickCepId})`);
            } else {
                log('当前没有选择客服');
            }
        }

        function testRandomSwitch() {
            const onlineAgents = mockChatUI.state.customerServiceData.filter(a => a.isOnline);
            if (onlineAgents.length > 0) {
                const randomAgent = onlineAgents[Math.floor(Math.random() * onlineAgents.length)];
                log(`随机切换到客服: ${randomAgent.employeeEnName}`);
                mockChatUI.selectAgent(randomAgent.quickCepId);
            } else {
                log('没有在线客服可切换');
            }
        }

        // 初始化
        log('测试页面已加载');
        updateCurrentAgentDisplay();
        updateAgentList();
    </script>
</body>
</html>