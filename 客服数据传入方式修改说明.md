# 客服数据传入方式修改说明

## 修改概述

将客服数据从 `ChatCustomUI` 类中的硬编码改为可以在 `chatManager.init()` 时动态传入，提高了系统的灵活性和可维护性。

## 主要修改

### 1. ChatCustomUI 类修改

**文件**: `composables/useChatCustomUI.ts`

- **构造函数修改**: 现在可以接收可选的 `customerServiceData` 参数
- **方法重命名**: `init()` 方法重命名为 `initDefaultCustomerServiceData()`，只在没有传入数据时调用
- **新增方法**: `setCustomerServiceData()` 方法，用于动态设置客服数据

```typescript
// 修改前
constructor() {
  // ...
  this.init(); // 总是调用，使用硬编码数据
}

// 修改后
constructor(customerServiceData?: CustomerServiceAgent[]) {
  // ...
  // 如果没有传入客服数据，使用默认数据
  if (!customerServiceData || customerServiceData.length === 0) {
    this.initDefaultCustomerServiceData();
  }
}
```

### 2. ChatManager 类修改

**文件**: `composables/useChatManager.ts`

- **构造函数修改**: 可以接收可选的客服数据参数
- **init方法修改**: 可以接收客服数据参数，并传递给 `ChatCustomUI`
- **类型定义**: 添加了 `CustomerServiceAgent` 接口定义

```typescript
// 修改前
constructor() {
  // 构造函数保持简洁
}

async init(): Promise<void> {
  // ...
  this.chatUI = new ChatCustomUI();
}

// 修改后
constructor(customerServiceData?: CustomerServiceAgent[]) {
  this.customerServiceData = customerServiceData;
}

async init(customerServiceData?: CustomerServiceAgent[]): Promise<void> {
  // ...
  const finalCustomerServiceData = customerServiceData || this.customerServiceData;
  this.chatUI = new ChatCustomUI(finalCustomerServiceData);
}
```

### 3. app.vue 使用示例

**文件**: `app.vue`

现在在初始化时传入客服数据：

```typescript
// 定义客服数据
const customerServiceData = [
  {
    employeeEnName: "test_01",
    quickCepId: "1938524999731687426",
    // ... 其他属性
  },
  // ... 更多客服数据
];

// 创建并初始化聊天管理器，传入客服数据
const chatManager = new ChatManager();
await chatManager.init(customerServiceData);
```

## 新增功能

### 1. 客服数据API管理器

**文件**: `composables/useCustomerServiceAPI.ts`

提供了从不同数据源获取客服数据的方法：

- `fetchCustomerServiceData()`: 从API获取数据
- `fetchFromLocalFile()`: 从本地JSON文件获取数据
- `getDefaultCustomerServiceData()`: 获取默认数据
- `validateCustomerServiceData()`: 验证数据格式

### 2. 示例JSON文件

**文件**: `public/customer-service-data.json`

提供了标准的客服数据格式示例。

### 3. 高级使用示例

**文件**: `app-with-api-example.vue`

展示了如何使用API获取客服数据的完整示例，包括错误处理和降级方案。

## 使用方式

### 方式1: 直接传入数据

```typescript
const customerServiceData = [/* 客服数据 */];
const chatManager = new ChatManager();
await chatManager.init(customerServiceData);
```

### 方式2: 构造函数传入

```typescript
const customerServiceData = [/* 客服数据 */];
const chatManager = new ChatManager(customerServiceData);
await chatManager.init();
```

### 方式3: 从API获取

```typescript
const customerServiceAPI = new CustomerServiceAPI();
const customerServiceData = await customerServiceAPI.fetchCustomerServiceData();
const chatManager = new ChatManager();
await chatManager.init(customerServiceData);
```

### 方式4: 从本地文件获取

```typescript
const customerServiceAPI = new CustomerServiceAPI();
const customerServiceData = await customerServiceAPI.fetchFromLocalFile('/customer-service-data.json');
const chatManager = new ChatManager();
await chatManager.init(customerServiceData);
```

### 方式5: 使用默认数据

```typescript
// 不传入任何数据，使用默认的硬编码数据
const chatManager = new ChatManager();
await chatManager.init();
```

## 向后兼容性

- 如果不传入客服数据，系统会自动使用默认的硬编码数据
- 现有的调用方式仍然有效
- 所有现有功能保持不变

## 优势

1. **灵活性**: 可以从多种数据源获取客服数据
2. **可维护性**: 客服数据不再硬编码在代码中
3. **可扩展性**: 易于添加新的数据源
4. **错误处理**: 提供了完善的错误处理和降级方案
5. **类型安全**: 使用TypeScript接口确保数据格式正确

## 注意事项

1. 客服数据必须符合 `CustomerServiceAgent` 接口定义
2. 建议在生产环境中使用API获取数据，开发环境可以使用本地文件
3. 始终提供降级方案，确保系统在数据获取失败时仍能正常工作
4. 数据验证很重要，确保传入的数据格式正确