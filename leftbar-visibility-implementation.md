# 左侧栏可见性功能实现总结

## 需求
当无客服在线时，不需要显示自定义左侧UI。

## 实现方案

### 1. 在 `ChatManager` 中添加左侧栏可见性控制

#### 新增方法：`updateLeftBarVisibility()`
- 检查是否有客服在线
- 根据在线状态控制左侧栏的显示/隐藏
- 有客服在线时显示，无客服在线时隐藏

#### 修改 `mountCustomComponents()` 方法
- 移除了无条件显示左侧栏的代码
- 改为调用 `updateLeftBarVisibility()` 根据客服状态决定是否显示

#### 修改事件监听器
- 在客服状态更新事件中添加左侧栏可见性更新
- 确保状态变化时及时更新UI显示

### 2. 在 `ChatCustomUI` 中添加支持方法

#### 新增方法：`hasOnlineAgents()`
- 检查客服数据中是否有在线的客服
- 返回布尔值表示是否有客服在线

#### 新增方法：`setOnAgentStatusChangeCallback()`
- 设置状态变化回调函数
- 允许 `ChatManager` 在状态变化时得到通知

#### 修改 `refreshUI()` 方法
- 在UI刷新时调用状态变化回调
- 确保UI更新时同步更新左侧栏可见性

#### 修改 `toggleLeftBar()` 方法
- 添加在线客服检查
- 如果没有客服在线，阻止用户手动显示左侧栏

### 3. 初始化流程优化

#### 修改 `init()` 方法
- 在创建UI实例后立即设置状态变化回调
- 确保回调机制在初始化时就建立

#### 修改 `initializeAgentStatus()` 方法
- 在获取客服状态后更新左侧栏可见性
- 确保初始状态正确

## 关键逻辑流程

1. **初始化时**：
   - 创建 `ChatCustomUI` 实例
   - 设置状态变化回调
   - 挂载组件时根据客服状态决定左侧栏可见性

2. **状态更新时**：
   - 接收客服状态更新事件
   - 更新客服数据
   - 刷新UI
   - 触发状态变化回调
   - 更新左侧栏可见性

3. **用户交互时**：
   - 用户尝试切换左侧栏
   - 检查是否有客服在线
   - 如果无客服在线，阻止显示操作

## 测试验证

创建了 `test-leftbar-visibility.html` 测试页面，用于验证：
- 所有客服离线时左侧栏隐藏
- 部分客服在线时左侧栏显示
- 所有客服在线时左侧栏显示
- 状态切换的正确性

## 代码修改文件

1. `composables/useChatManager.ts`
   - 新增 `updateLeftBarVisibility()` 方法
   - 修改 `mountCustomComponents()` 方法
   - 修改客服状态更新事件监听器
   - 修改 `init()` 和 `initializeAgentStatus()` 方法

2. `composables/useChatCustomUI.ts`
   - 新增 `hasOnlineAgents()` 方法
   - 新增 `setOnAgentStatusChangeCallback()` 方法
   - 修改 `refreshUI()` 方法
   - 修改 `toggleLeftBar()` 方法
   - 添加回调函数属性

## 功能特点

- **自动控制**：根据客服在线状态自动显示/隐藏左侧栏
- **实时更新**：客服状态变化时立即更新UI
- **用户友好**：阻止用户在无客服时显示空的左侧栏
- **向后兼容**：不影响现有的其他功能
- **性能优化**：只在状态真正变化时更新UI

## 日志输出

实现中添加了详细的控制台日志，便于调试：
- "有客服在线，显示左侧栏"
- "无客服在线，隐藏左侧栏"
- "无客服在线，无法显示左侧栏"

这些日志可以帮助开发者了解左侧栏可见性的控制逻辑是否正常工作。